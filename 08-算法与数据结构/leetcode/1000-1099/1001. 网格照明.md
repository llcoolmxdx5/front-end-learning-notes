# [1001. 网格照明](https://leetcode-cn.com/problems/grid-illumination/)

## 题目

在大小为 `n x n` 的网格 `grid` 上，每个单元格都有一盏灯，最初灯都处于**关闭**状态。

给你一个由灯的位置组成的二维数组  `lamps` ，其中 `lamps[i] = [row_i, col_i]` 表示**打开**位于 `grid[row_i][col_i]` 的灯。即便同一盏灯可能在 `lamps` 中多次列出，不会影响这盏灯处于**打开**状态。

当一盏灯处于打开状态，它将会照亮**自身所在单元格**以及同一**行**、同一**列**和两条**对角线**上的**所有其他单元格**。

另给你一个二维数组 `queries` ，其中 `queries[j] = [row_j, col_j]` 。对于第 `j` 个查询，如果单元格 `[row_j, col_j]` 是被照亮的，则查询结果为 1 ，否则为 0 。在第 `j` 次查询之后 [按照查询的顺序] ，关闭**位于单元格** `grid[row_j][col_j]` 上及相邻 8 个方向上（与单元格 `grid[row_i][col_i]` 共享角或边）的任何灯。

返回一个整数数组 `ans` 作为答案， `ans[j]` 应等于第 `j` 次查询  `queries[j]`  的结果，1 表示照亮，0 表示未照亮。

示例 1：

![eg1](./imgs/10001-eg1.jpg)

```txt
输入：n = 5, lamps = [[0,0],[4,4]], queries = [[1,1],[1,0]]
输出：[1,0]
解释：最初所有灯都是关闭的。在执行查询之前，打开位于 [0, 0] 和 [4, 4] 的灯。第 0 次查询检查 grid[1][1] 是否被照亮（蓝色方框）。该单元格被照亮，所以 ans[0] = 1 。然后，关闭红色方框中的所有灯。

第 1 次查询检查 grid[1][0] 是否被照亮（蓝色方框）。该单元格没有被照亮，所以 ans[1] = 0 。然后，关闭红色矩形中的所有灯。
```

示例 2：

```txt
输入：n = 5, lamps = [[0,0],[4,4]], queries = [[1,1],[1,1]]
输出：[1,1]
```

示例 3：

```txt
输入：n = 5, lamps = [[0,0],[0,4]], queries = [[0,4],[0,1],[1,4]]
输出：[1,1,0]
```

提示：

- `1 <= n <= 10^9`
- `0 <= lamps.length <= 20000`
- `0 <= queries.length <= 20000`
- `lamps[i].length == 2`
- `0 <= row_i, col_i < n`
- `queries[j].length == 2`
- `0 <= row_j, col_j < n`

## 难度

困难

## 标签

数组 哈希表

## 解题思路

### 哈希表 + 线映射

棋盘大小的数据范围为 `n = 10^9` ，硬模拟「亮灯」的操作必然会 TLE，而 `lamps` 和 `queries` 数据范围为 20000 是一个较为常见的突破口。

由于点亮每一盏灯，可以使得当前 **行、列 和 对角线** 的位置被照亮，行列可直接使用棋盘坐标的 `(x, y)` 来代指，而对角线则可以使用「截距」来进行代指，即使用 `x + y` 和 `x - y` 进行代指。

分别使用四个「哈希表」`row`、`col`、`left` 和 `right` 来记录 行、列 和 对角线 的点亮情况（`key` 为线编号，`value` 为点亮次数）。

这样我们可以在 `O(1)` 的复杂度处理掉所有的 `lamps[i]`，某个位置被照亮的充要条件为：「当前位置所在行被点亮」或「当前位置所在列被点亮」或「当前位置所处的对角线被点亮」。

同时，由于每次查询后要进行「灭灯」操作（注意：灭灯只能灭有灯的位置，而不是灭有光的位置 🤣），因此我们还需要另外记录每个灯的位置，可以使用利用「二维转一维」的技巧进行编号：`idx = x * n + y` ，并使用 `HashSet` 进行记录（忽略重复的 `lamps[i]`）。

由于询问次数最多为 20000，因此直接在查询完成后模拟「灭灯」即可（访问自身及相邻格子，共 9 个），计算量为 `2 * 10^5` 以内，可以接受。若某个位置存在灯，将其从 `HashSet` 中移除，并更新对应线的点亮情况。

## 提交速度

- 执行用时：`496 ms`, 在所有 JavaScript 提交中击败了 `100.00%` 的用户
- 内存消耗：`75.8 MB`, 在所有 JavaScript 提交中击败了 `100.00%` 的用户
