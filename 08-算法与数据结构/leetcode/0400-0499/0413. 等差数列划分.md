# [413. 等差数列划分](https://leetcode-cn.com/problems/arithmetic-slices/)

## 题目

如果一个数列 至少有三个元素 ，并且任意两个相邻元素之差相同，则称该数列为等差数列。

例如，`[1,3,5,7,9]`、`[7,7,7,7]` 和 `[3,-1,-5,-9]` 都是等差数列。
给你一个整数数组 `nums` ，返回数组 `nums` 中所有为等差数组的**子数组**个数。

**子数组**是数组中的一个连续序列。

示例 1：

```txt
输入：nums = [1,2,3,4]
输出：3
解释：nums 中有三个子等差数组：[1, 2, 3]、[2, 3, 4] 和 [1,2,3,4] 自身。
```

示例 2：

```txt
输入：nums = [1]
输出：0
```

提示：

- `1 <= nums.length <= 5000`
- `-1000 <= nums[i] <= 1000`

## 难度

中等

## 标签

数组 动态规划

## 解题思路

### 动态规划

定义 `dp[i][j]` 为 `i` 到 `j` 是否为等差数列

思路与 「5.最长回文子串一致」

该解法容易超时

复杂度分析

- 时间复杂度：`O(n^2)`，其中 `n` 是字符串的长度。动态规划的状态总数为 `O(n^2)`，对于每个状态，我们需要转移的时间为 `O(1)`。
- 空间复杂度：`O(n^2)`，即存储动态规划状态需要的空间。

### 差分 + 计数

举例 `[1, 2, 3, 4, 5, 19, 20, 30, 40]`。答案为 7。

首先容易观察到：

- 长度为 3 的等差数列，可以贡献 1 种答案。例如 `[1,2,3]` 。
- 长度为 4 的等差数列，可以贡献 3 种答案。例如 `[1,2,3,4]` ，有长度为 3 的子数列 `[1,2,3]` 和 `[2,3,4]` 两种。以及长度为 4 的数列 `[1,2,3,4]` 一种。一共是 1+2=3 种。
- 长度为 5 的等差数列，可以贡献 6 种答案。例如 `[1,2,3,4,5]` ，有长度为 3 的子数列 `[1,2,3]` 和 `[2,3,4]` 和 `[3,4,5]` 三种，以及长度为 4 的子数列 `[1,2,3,4]` 和 `[2,3,4,5]` 两种，以及长度为 5 的数列 `[1,2,3,4,5]` 一种。一共是 1+2+3=6 种。

假设我们已经找到了一个长度为 3 的等差数列。它可以给答案带来一种贡献。

如果遍历到下一个数时，发现这个数可以拼接到前面长度为 3 的等差数列的末尾，形成一个长度为 4 的等差数列，那么把长度为 3 的等差数列的答案贡献数加一，就是由于这次拼接带来的新的贡献数。当前长度为 4 的等差数列，这次拼接新的贡献量为 1+1=2。

同理，下一次遍历又发现一个数可以在已发现的长度为 4 的等差数列的基础上，拼接成长度为 5 的等差数列，那么新的贡献量就是 2+1=3.

如果下一个数无法与前面的数列行成新的等差数列，那么贡献量清零。

回到例子 `[1, 2, 3, 4, 5, 19, 20, 30, 40]`，我们从前往后遍历：

- 形成 `[1,2,3]` 时，当前新贡献量为 1，答案加 1。
- 形成 `[1,2,3,4]` 时，当前新贡献量为 2，答案再加 2。
- 形成 `[1,2,3,4,5]` 时，当前新贡献量为 3，答案再加 3。
- 遇到了 19，贡献量清零。
- 最后遇到 `[20, 30, 40]`，当前新贡献量为 1，答案再加 1。
- 结束，返回答案：7。

复杂度分析

- 时间复杂度：`O(n)`，其中 `n` 是数组 `nums` 的长度。
- 空间复杂度：`O(1)`。

## 提交速度

- 执行用时：`72 ms`, 在所有 JavaScript 提交中击败了 `50.18%` 的用户
- 内存消耗：`37.7 MB`, 在所有 JavaScript 提交中击败了 `51.83%` 的用户
